function [BW,maskedImage] = segmentImage(RGB)
%segmentImage Segment image using auto-generated code from imageSegmenter app
%  [BW,MASKEDIMAGE] = segmentImage(RGB) segments image RGB using
%  auto-generated code from the imageSegmenter app. The final segmentation
%  is returned in BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 14-Nov-2022
%----------------------------------------------------


% Convert RGB image into L*a*b* color space.
X = rgb2lab(RGB);

% Create empty mask.
BW = false(size(X,1),size(X,2));

% Local graph cut
xPos = [38.5051 219.5657 219.5657 38.5051 ];
yPos = [11.1768 11.1768 172.5404 172.5404 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [7197 7200 7206 7209 7213 7218 7377 7380 7407 7562 7596 7743 7782 7783 7924 7926 8104 8108 8156 8286 8288 8467 8470 8649 8650 8832 8901 9010 9014 9191 9193 9374 9376 9555 9558 9647 9736 9738 9920 10019 10105 10206 10288 10392 10471 10950 11204 11509 11573 11756 11881 11940 12124 12254 12307 12440 12491 12626 12675 12858 12998 13040 13041 13185 13225 13410 13557 13598 13970 14116 14341 14488 14527 15047 15084 15233 15419 15791 15827 16163 16349 16721 16907 17279 17465 17501 18025 18398 18584 18770 18957 18989 19175 19329 19515 19701 19733 20073 20444 20477 20816 21035 21188 21221 21373 21593 21745 22151 22302 22674 22895 23231 23267 23603 23639 23975 24197 24346 24718 24755 25090 25276 25462 25499 25834 26020 26057 26206 26578 26615 26801 26950 27173 27322 27545 27694 27731 28066 28438 28476 28810 28848 29035 29182 29554 29594 29968 30112 30154 30341 30342 30484 30529 30670 30717 30904 31041 31091 31227 31279 31652 31784 31839 32027 32215 32403 32713 32778 32967 33155 33342 33530 33642 33718 33907 34095 34283 34385 34471 34845 35034 35222 35314 35410 35598 35785 35973 36056 36160 36534 36721 36798 37095 37469 37727 37843 37912 38217 38283 38404 38467 38838 38964 39023 39206 39207 39338 39390 39392 39760 39899 39944 40128 40272 40273 40313 40460 40497 40647 40648 40649 40650 40651 40653 40655 40657 40658 40660 40680 ];
backgroundInd = [7541 7543 7544 7722 7724 7906 7907 8089 8090 8091 8271 8272 8348 8454 8455 8534 8637 8638 8639 8721 9178 9179 9279 9362 9546 9729 9731 9910 9913 10024 10092 10093 10095 10253 10254 10257 10260 10262 10263 10274 10276 10277 10447 10456 10458 10640 10817 10823 10825 11007 11008 11141 11191 11372 11374 11559 11742 11885 11923 11924 11925 11927 11928 12071 12257 13001 14305 14677 14863 15049 15422 15608 15794 29187 29373 29745 29931 30117 30489 30675 31046 31418 31604 31646 31789 31832 31833 32017 32020 32021 32161 32203 32207 32208 32347 32390 32394 32395 32396 32532 32577 32580 32583 32764 32771 32952 32953 32958 32959 33090 33146 33147 33335 33336 33524 33646 33711 33712 33713 33901 34088 34089 34090 34203 34277 34278 34464 34465 34466 34573 34574 34653 34840 35027 35215 35216 35402 35404 35591 35592 35779 35780 35781 35968 35969 36156 36343 36344 36531 36904 37277 37651 37838 38398 38771 38958 ];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Local graph cut
xPos = [34.2121 55.9293 55.9293 34.2121 ];
yPos = [101.0758 101.0758 161.9343 161.9343 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [6463 6464 6466 6467 6469 6470 6480 6650 6656 6666 6833 6843 7019 7028 7029 7039 7176 7177 7178 7198 7199 7202 7205 7206 7207 7208 7209 7210 7213 7215 7217 7365 7366 7367 7369 7396 7398 7401 7404 7405 7407 7412 7559 7560 7562 7565 7568 7571 7573 7586 7587 7592 7594 7595 7748 7762 7781 7782 7925 7927 7928 7935 7952 7956 7967 7968 7971 7972 7973 8118 8122 8144 8154 8156 8158 8159 8306 8309 8340 8520 8527 8530 8710 8713 8715 8716 ];
backgroundInd = [];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Local graph cut
xPos = [174.6162 236.7374 236.7374 174.6162 ];
yPos = [24.5606 24.5606 170.0152 170.0152 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [32693 32699 32701 32702 32832 32849 33001 33058 33180 33181 33211 33252 33381 33427 33428 33432 33434 33435 33436 33437 33441 33442 33446 33449 33450 33452 33453 33627 33628 33633 33637 33638 33777 33822 33937 33996 34118 34119 34123 34160 34161 34162 34164 34168 34174 34177 34178 34179 34193 34198 34276 34278 34295 34302 34308 34310 34316 34319 34325 34345 34346 34347 34348 34384 34461 34466 34467 34468 34469 34495 34543 34564 34570 34646 34647 34749 34838 34844 34851 34852 34888 34893 34941 35018 35019 35024 35063 35078 35079 35087 35088 35104 35119 35120 35122 35123 35127 35204 35205 35218 35306 35312 35390 35392 35395 35396 35406 35438 35447 35498 35576 35602 35621 35626 35635 35636 35656 35684 35763 35764 35768 35780 35781 35801 35802 35811 35830 35833 35845 35869 35950 35951 35952 35953 35968 36050 36159 36165 36166 36194 36200 36342 36375 36376 36403 36422 36426 36542 36547 36556 36608 36716 36724 36736 36746 36750 36757 36771 36773 36794 36903 36966 36983 37169 37277 37332 37352 37541 37652 37684 37686 37689 37840 37856 37859 37910 37912 38215 38229 38255 38284 38404 38409 38468 38627 38780 38783 38821 38822 38842 38969 38971 39027 39158 39213 39345 39393 39534 39578 39585 39718 39719 39722 39725 39762 39770 39906 39912 39916 39947 39953 39955 40093 40104 40106 40131 40137 40280 40282 40295 40296 40300 40303 40306 40312 40313 40315 40316 40319 40470 40473 40474 40478 40480 40483 40485 40487 40488 40489 40490 40491 40493 40495 40497 40498 ];
backgroundInd = [];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Local graph cut
xPos = [201.3838 240.0202 240.0202 201.3838 ];
yPos = [128.3485 128.3485 167.7424 167.7424 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [];
backgroundInd = [38664 38665 38849 38851 39036 39220 39221 39222 39403 39404 39406 39586 39767 39768 39770 39771 39777 39778 39951 39952 39959 39963 40136 40146 40148 40150 40321 40332 40336 40514 40517 40522 40690 40701 40703 40706 41069 41075 41247 41254 41432 41434 41435 41437 41441 41615 41624 41627 41797 41803 41988 41995 42173 42178 42358 42363 42366 42543 42544 42545 42548 42731 42733 42916 43100 ];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Local graph cut
xPos = [30.4242 59.2121 59.2121 30.4242 ];
yPos = [133.3990 133.3990 163.1970 163.1970 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [];
backgroundInd = [];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Local graph cut
xPos = [201.8889 230.6768 230.6768 201.8889 ];
yPos = [130.8737 130.8737 174.0556 174.0556 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [];
backgroundInd = [];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Local graph cut
xPos = [204.1616 232.1919 232.1919 204.1616 ];
yPos = [125.3182 125.3182 175.8232 175.8232 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [];
backgroundInd = [38477 38481 38662 38663 38666 38846 38852 39030 39033 39037 39215 39218 39223 39400 39406 39407 39585 39592 39770 39776 39777 39959 39960 39963 40141 40143 40145 40325 40332 40511 40516 40518 40522 40523 40524 40693 40710 40877 40881 40882 40884 40890 40896 41058 41059 41060 41061 41072 41240 41242 41252 41257 41427 41430 41437 41443 41616 41617 41619 41621 41622 41637 41802 41987 41988 42171 42189 42374 42376 ];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Local graph cut
xPos = [29.4141 118.8081 118.8081 29.4141 ];
yPos = [11.4293 11.4293 164.2071 164.2071 ];
m = size(BW, 1);
n = size(BW, 2);
ROI = poly2mask(xPos,yPos,m,n);
foregroundInd = [7366 7368 7370 7371 7372 7493 7544 7549 7677 7680 7725 7863 7867 7868 7869 8049 8053 8054 8092 8235 8240 8241 8273 8274 8275 8421 8428 8451 8452 8456 8608 8612 8614 8636 8798 8800 8819 8981 8985 8987 9168 9171 9173 9189 9354 9355 9357 9360 9374 9540 9542 9547 9548 9557 9559 9728 9734 9735 9736 9737 9739 9740 9913 10098 10282 10283 10466 10467 10650 10835 11019 11020 11202 11386 11755 11939 12123 12307 12492 12676 12677 12861 12862 13045 13046 13229 13230 13413 13414 ];
backgroundInd = [6190 6191 6192 6193 6375 6560 6566 6753 6754 6932 7127 7350 7351 7523 7525 7527 7531 7533 7675 7689 7690 7706 7708 7862 7877 7887 7889 8048 8066 8067 8068 8070 8234 8246 8247 8248 8250 8435 8436 8606 8791 8792 8976 9161 9345 9716 10087 10272 10456 10457 10640 10641 10824 10826 11192 11559 12110 12293 ];
L = superpixels(X,333,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = BW | grabcut(scaledX,L,ROI,foregroundInd,backgroundInd);

% Create masked image.
maskedImage = RGB;
maskedImage(repmat(~BW,[1 1 3])) = 0;
end

function out = prepLab(in)

% Convert L*a*b* image to range [0,1]
out = in;
out(:,:,1)   = in(:,:,1) / 100;  % L range is [0 100].
out(:,:,2:3) = (in(:,:,2:3) + 100) / 200;  % a* and b* range is [-100,100].

end
